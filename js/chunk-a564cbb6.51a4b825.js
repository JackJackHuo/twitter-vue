(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a564cbb6"],{"04d1":function(t,e,s){var a=s("342f"),r=a.match(/firefox\/(\d+)/i);t.exports=!!r&&+r[1]},"3b6a":function(t,e,s){t.exports=s.p+"img/Vector_newChat.1db1c50c.svg"},"4af3":function(t,e,s){"use strict";s("89e2")},"4e82":function(t,e,s){"use strict";var a=s("23e7"),r=s("e330"),n=s("59ed"),o=s("7b0b"),i=s("07fa"),c=s("577e"),u=s("d039"),l=s("addb"),h=s("a640"),d=s("04d1"),f=s("d998"),m=s("2d00"),g=s("512c"),v=[],p=r(v.sort),_=r(v.push),C=u((function(){v.sort(void 0)})),b=u((function(){v.sort(null)})),w=h("sort"),M=!u((function(){if(m)return m<70;if(!(d&&d>3)){if(f)return!0;if(g)return g<603;var t,e,s,a,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)v.push({k:e+a,v:s})}for(v.sort((function(t,e){return e.v-t.v})),a=0;a<v.length;a++)e=v[a].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return"DGBEFHACIJK"!==r}})),k=C||!b||!w||!M,x=function(t){return function(e,s){return void 0===s?-1:void 0===e?1:void 0!==t?+t(e,s)||0:c(e)>c(s)?1:-1}};a({target:"Array",proto:!0,forced:k},{sort:function(t){void 0!==t&&n(t);var e=o(this);if(M)return void 0===t?p(e):p(e,t);var s,a,r=[],c=i(e);for(a=0;a<c;a++)a in e&&_(r,e[a]);l(r,x(t)),s=r.length,a=0;while(a<s)e[a]=r[a++];while(a<c)delete e[a++];return e}})},"512c":function(t,e,s){var a=s("342f"),r=a.match(/AppleWebKit\/(\d+)\./);t.exports=!!r&&+r[1]},5889:function(t,e,s){},8769:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{staticClass:"online_users"},[a("div",{staticClass:"online_users-part"},[t._m(0),t._l(t.users,(function(e){return a("div",{key:e.chatUser.id,staticClass:"online_user",on:{click:function(s){return t.getRoomName(e.chatUser.id)}}},[a("router-link",{staticClass:"user-avatar-link",attrs:{to:"#"}},[a("div",{staticClass:"online_user-image"},[a("img",{staticClass:"user-image",attrs:{src:e.chatUser.avatar,alt:""}})])]),a("div",{staticClass:"online_user-info"},[a("router-link",{staticClass:"user-name-link",attrs:{to:"#"}},[a("div",{staticClass:"user-name"},[t._v(t._s(e.chatUser.name))])]),a("div",{staticClass:"user-account"},[t._v("@"+t._s(e.chatUser.account))])],1),a("p",{staticClass:"user-recentchat"},[t._v(t._s(e.content))])],1)}))],2),a("div",{staticClass:"chat_room"},[a("div",{staticClass:"chat_room-part"},[t._m(1),a("div",{ref:"chatContainer",staticClass:"chat_room-part-container scrollbar"},[a("div",{staticClass:"chat-content"},[a("ChatMessage",{attrs:{roomName:t.roomName},on:{"after-retrieve-allMessage":t.scrollToBottom}})],1)]),a("div",{staticClass:"chat_room-part-input"},[a("div",{staticClass:"input-container"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputMessage,expression:"inputMessage"}],staticClass:"message-input",attrs:{cols:"30",rows:"10",placeholder:"輸入訊息..."},domProps:{value:t.inputMessage},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSendChatBtnClicked.apply(null,arguments)},input:function(e){e.target.composing||(t.inputMessage=e.target.value)}}}),a("div",{staticClass:"input-button cursor-pointer",on:{click:t.handleSendChatBtnClicked}},[a("img",{attrs:{src:s("e483"),alt:""}})])])])])])])])},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-title"},[a("p",[t._v("訊息")]),a("img",{attrs:{src:s("3b6a"),alt:""}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat-title"},[s("p",[t._v("私人聊天室")])])}],n=s("2909"),o=s("1da1"),i=s("5530"),c=(s("d3b7"),s("b0c0"),s("4e82"),s("a434"),s("a15b"),s("96cf"),s("96c7")),u=s("d3cc"),l=s("4cce"),h=s("2f62"),d={name:"PrivateChatRoom",components:{ChatMessage:c["a"]},data:function(){return{chatUserId:void 0,users:[],roomName:"",inputMessage:""}},computed:Object(i["a"])({},Object(h["c"])({currentUser:function(t){return t.currentUserModule.currentUser}})),created:function(){this.$store.commit("statusControlModule/toggleTopUsersDisplayStatus","private-chatroom"),this.$socket.open();var t=this.$route.params.id;this.chatUserId=t,this.fetchLatest()},beforeDestroy:function(){this.leaveRoom()},methods:{fetchLatest:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u["a"].getLatest();case 3:if(s=e.sent,200===s.status){e.next=6;break}throw new Error(s.statusText);case 6:t.users=Object(n["a"])(s.data),t.getRoomName(t.chatUserId),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()},getRoomName:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function s(){var a,r,n,o,i;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(a=t||e.users[0].chatUser.id,s.prev=1,e.users.some((function(t){return t.chatUser.id===+a}))){s.next=12;break}return s.next=5,l["a"].getUsers({userId:a});case 5:if(r=s.sent,200===r.status){s.next=8;break}throw new Error(r.statusText);case 8:n=r.data,o={},o.chatUser={id:n.id,name:n.name,avatar:n.avatar,account:n.account},e.users.push(o);case 12:i=[e.currentUser.id,a],i.sort((function(t,e){return t-e})),i.splice(1,0,"R"),e.roomName=i.join(""),e.joinRoom(),s.next=22;break;case 19:s.prev=19,s.t0=s["catch"](1),console.log(s.t0);case 22:case"end":return s.stop()}}),s,null,[[1,19]])})))()},handleSendChatBtnClicked:function(){this.$socket.emit("sendMessage",{roomName:this.roomName,UserId:this.currentUser.id,content:this.inputMessage}),this.inputMessage="",this.scrollToBottom()},scrollToBottom:function(){this.$refs.chatContainer.scrollTo({top:this.$refs.chatContainer.scrollHeight,behavior:"smooth"})},joinRoom:function(){this.$socket.emit("join-room",this.roomName)},leaveRoom:function(){this.$socket.emit("leave-room",this.roomName)}}},f=d,m=(s("4af3"),s("2877")),g=Object(m["a"])(f,a,r,!1,null,"58035be5",null);e["default"]=g.exports},"89e2":function(t,e,s){},"96c7":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"chats__content"},[t.isLoading?s("Spinner"):t._l(t.chats,(function(e){return s("li",{key:e.id,class:["chat__content",{user__chat:e.UserId&&e.UserId!==t.currentUser.id}]},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.loginMsg&&!e.logoutMsg,expression:"!chat.loginMsg && !chat.logoutMsg"}],staticClass:"chat__container"},[e.UserId&&e.UserId!==t.currentUser.id?s("div",{staticClass:"chat__avatar--container"},[s("img",{staticClass:"chat__avatar",attrs:{src:t._f("emptyImage")(e.avatar),alt:""}})]):t._e(),s("div",{staticClass:"chat__content--info"},[s("p",{staticClass:"chat__content--message"},[t._v(t._s(e.content))]),s("span",{staticClass:"chat__content--createdAt"},[t._v(t._s(t._f("fromNow")(e.createdAt)))])])]),[s("div",{staticClass:"logMessageContainer"},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.loginMsg,expression:"chat.loginMsg"}],staticClass:"chat__logMsg"},[t._v(t._s(e.loginMsg))]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.logoutMsg,expression:"chat.logoutMsg"}],staticClass:"chat__logMsg"},[t._v(t._s(e.logoutMsg))])])]],2)}))],2)},r=[],n=s("2909"),o=s("1da1"),i=(s("96cf"),s("2f62")),c=s("2708"),u=s("d3cc"),l=s("2375"),h={name:"ChatMessage",components:{Spinner:l["a"]},props:{roomName:{type:String,required:!0}},watch:{roomName:function(){this.fetchHistoryMessage(this.roomName)}},data:function(){return{chats:[],isLoading:!1}},mixins:[c["b"],c["a"]],computed:Object(i["c"])({currentUser:function(t){return t.currentUserModule.currentUser}}),created:function(){this.fetchHistoryMessage(this.roomName)},updated:function(){this.$emit("after-retrieve-allMessage")},methods:{fetchHistoryMessage:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function s(){var a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(s.prev=0,e.isLoading=!0,!t){s.next=10;break}return s.next=5,u["a"].getHistory({roomName:t});case 5:if(a=s.sent,200===a.status){s.next=8;break}throw new Error(a.statusText);case 8:e.chats=Object(n["a"])(a.data),e.isLoading=!1;case 10:return s.abrupt("return");case 13:s.prev=13,s.t0=s["catch"](0),e.isLoading=!1,console.log(s.t0);case 17:case"end":return s.stop()}}),s,null,[[0,13]])})))()}},sockets:{connect:function(){console.log("socket connected")},newMessage:function(t){this.chats.push(t),console.log(t)},loginMsg:function(t){this.chats.push({loginMsg:t})},logoutMsg:function(t){this.chats.push({logoutMsg:t})},disconnected:function(){this.$socket.emit("disconnect",this.currentUser.id)}}},d=h,f=(s("cefc"),s("2877")),m=Object(f["a"])(d,a,r,!1,null,"a3477b1a",null);e["a"]=m.exports},a15b:function(t,e,s){"use strict";var a=s("23e7"),r=s("e330"),n=s("44ad"),o=s("fc6a"),i=s("a640"),c=r([].join),u=n!=Object,l=i("join",",");a({target:"Array",proto:!0,forced:u||!l},{join:function(t){return c(o(this),void 0===t?",":t)}})},a434:function(t,e,s){"use strict";var a=s("23e7"),r=s("da84"),n=s("23cb"),o=s("5926"),i=s("07fa"),c=s("7b0b"),u=s("65f0"),l=s("8418"),h=s("1dde"),d=h("splice"),f=r.TypeError,m=Math.max,g=Math.min,v=9007199254740991,p="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!d},{splice:function(t,e){var s,a,r,h,d,_,C=c(this),b=i(C),w=n(t,b),M=arguments.length;if(0===M?s=a=0:1===M?(s=0,a=b-w):(s=M-2,a=g(m(o(e),0),b-w)),b+s-a>v)throw f(p);for(r=u(C,a),h=0;h<a;h++)d=w+h,d in C&&l(r,h,C[d]);if(r.length=a,s<a){for(h=w;h<b-a;h++)d=h+a,_=h+s,d in C?C[_]=C[d]:delete C[_];for(h=b;h>b-a+s;h--)delete C[h-1]}else if(s>a)for(h=b-a;h>w;h--)d=h+a-1,_=h+s-1,d in C?C[_]=C[d]:delete C[_];for(h=0;h<s;h++)C[h+w]=arguments[h+2];return C.length=b-a+s,r}})},addb:function(t,e,s){var a=s("f36a"),r=Math.floor,n=function(t,e){var s=t.length,c=r(s/2);return s<8?o(t,e):i(t,n(a(t,0,c),e),n(a(t,c),e),e)},o=function(t,e){var s,a,r=t.length,n=1;while(n<r){a=n,s=t[n];while(a&&e(t[a-1],s)>0)t[a]=t[--a];a!==n++&&(t[a]=s)}return t},i=function(t,e,s,a){var r=e.length,n=s.length,o=0,i=0;while(o<r||i<n)t[o+i]=o<r&&i<n?a(e[o],s[i])<=0?e[o++]:s[i++]:o<r?e[o++]:s[i++];return t};t.exports=n},cefc:function(t,e,s){"use strict";s("5889")},d3cc:function(t,e,s){"use strict";var a=s("2fa3");e["a"]={getHistory:function(t){var e=t.roomName;return a["b"].get("/chat/messages/".concat(e))},getLatest:function(){return a["b"].get("/chat/messages/latest")}}},d998:function(t,e,s){var a=s("342f");t.exports=/MSIE|Trident/.test(a)},e483:function(t,e,s){t.exports=s.p+"img/Vector_send-icon.dd906591.svg"}}]);
//# sourceMappingURL=chunk-a564cbb6.51a4b825.js.map