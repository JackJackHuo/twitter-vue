(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-325726d7"],{"2e10":function(t,e,s){"use strict";s("9ab9")},5889:function(t,e,s){},"96c7":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"chats__content"},[t.isLoading?s("Spinner"):t._l(t.chats,(function(e){return s("li",{key:e.id,class:["chat__content",{user__chat:e.UserId&&e.UserId!==t.currentUser.id}]},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.loginMsg&&!e.logoutMsg,expression:"!chat.loginMsg && !chat.logoutMsg"}],staticClass:"chat__container"},[e.UserId&&e.UserId!==t.currentUser.id?s("div",{staticClass:"chat__avatar--container"},[s("img",{staticClass:"chat__avatar",attrs:{src:t._f("emptyImage")(e.avatar),alt:""}})]):t._e(),s("div",{staticClass:"chat__content--info"},[s("p",{staticClass:"chat__content--message"},[t._v(t._s(e.content))]),s("span",{staticClass:"chat__content--createdAt"},[t._v(t._s(t._f("fromNow")(e.createdAt)))])])]),[s("div",{staticClass:"logMessageContainer"},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.loginMsg,expression:"chat.loginMsg"}],staticClass:"chat__logMsg"},[t._v(t._s(e.loginMsg))]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.logoutMsg,expression:"chat.logoutMsg"}],staticClass:"chat__logMsg"},[t._v(t._s(e.logoutMsg))])])]],2)}))],2)},n=[],o=s("2909"),i=s("1da1"),r=(s("96cf"),s("2f62")),c=s("2708"),l=s("d3cc"),u=s("2375"),h={name:"ChatMessage",components:{Spinner:u["a"]},props:{roomName:{type:String,required:!0}},watch:{roomName:function(){this.fetchHistoryMessage(this.roomName)}},data:function(){return{chats:[],isLoading:!1}},mixins:[c["b"],c["a"]],computed:Object(r["c"])({currentUser:function(t){return t.currentUserModule.currentUser}}),created:function(){this.fetchHistoryMessage(this.roomName)},updated:function(){this.$emit("after-retrieve-allMessage")},methods:{fetchHistoryMessage:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function s(){var a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(s.prev=0,e.isLoading=!0,!t){s.next=10;break}return s.next=5,l["a"].getHistory({roomName:t});case 5:if(a=s.sent,200===a.status){s.next=8;break}throw new Error(a.statusText);case 8:e.chats=Object(o["a"])(a.data),e.isLoading=!1;case 10:return s.abrupt("return");case 13:s.prev=13,s.t0=s["catch"](0),e.isLoading=!1,console.log(s.t0);case 17:case"end":return s.stop()}}),s,null,[[0,13]])})))()}},sockets:{connect:function(){console.log("socket connected")},newMessage:function(t){this.chats.push(t),console.log(t)},loginMsg:function(t){this.chats.push({loginMsg:t})},logoutMsg:function(t){this.chats.push({logoutMsg:t})},disconnected:function(){this.$socket.emit("disconnect",this.currentUser.id)}}},g=h,d=(s("cefc"),s("2877")),m=Object(d["a"])(g,a,n,!1,null,"a3477b1a",null);e["a"]=m.exports},"9ab9":function(t,e,s){},cefc:function(t,e,s){"use strict";s("5889")},d3cc:function(t,e,s){"use strict";var a=s("2fa3");e["a"]={getHistory:function(t){var e=t.roomName;return a["b"].get("/chat/messages/".concat(e))},getLatest:function(){return a["b"].get("/chat/messages/latest")}}},d583:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{staticClass:"online_users"},[a("div",{staticClass:"online_users-part"},[a("div",{staticClass:"user-title"},[a("p",[t._v("上線用戶("+t._s(t.loginUsers.length)+")")])]),t._l(t.loginUsers,(function(e){return a("div",{key:e.id,staticClass:"online_user"},[a("router-link",{staticClass:"user-avatar-link",attrs:{to:"#"}},[a("div",{staticClass:"online_user-image"},[a("img",{staticClass:"user-image",attrs:{src:e.avatar,alt:""}})])]),a("div",{staticClass:"online_user-info"},[a("router-link",{staticClass:"user-name-link",attrs:{to:"#"}},[a("div",{staticClass:"user-name"},[t._v(t._s(e.name))])]),a("div",{staticClass:"user-account"},[t._v("@"+t._s(e.account))])],1)],1)}))],2),a("div",{staticClass:"chat_room"},[a("div",{staticClass:"chat_room-part"},[t._m(0),a("div",{ref:"chatContainer",staticClass:"chat_room-part-container scrollbar"},[a("ChatMessage",{attrs:{roomName:t.roomName},on:{"after-retrieve-allMessage":t.scrollToBottom}})],1),a("div",{staticClass:"chat_room-part-input"},[a("div",{staticClass:"input-container"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputMessage,expression:"inputMessage"}],staticClass:"message-input",attrs:{cols:"30",rows:"10",placeholder:"輸入訊息..."},domProps:{value:t.inputMessage},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSendChatBtnClicked.apply(null,arguments)},input:function(e){e.target.composing||(t.inputMessage=e.target.value)}}}),a("div",{staticClass:"input-button cursor-pointer",on:{click:t.handleSendChatBtnClicked}},[a("img",{attrs:{src:s("e483"),alt:""}})])])])])])])])},n=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat-title"},[s("p",[t._v("公開聊天室")])])}],o=s("2909"),i=s("96c7"),r=s("2f62"),c={name:"PublicChatRoom",components:{ChatMessage:i["a"]},data:function(){return{user:{},inputMessage:"",loginUsers:[],roomName:"public"}},computed:Object(r["c"])({currentUser:function(t){return t.currentUserModule.currentUser}}),created:function(){this.$store.commit("statusControlModule/toggleTopUsersDisplayStatus","public-chatroom"),this.$socket.open(),this.joinRoom()},beforeDestroy:function(){this.leaveRoom()},sockets:{loginUsers:function(t){this.loginUsers=Object(o["a"])(t)}},methods:{handleSendChatBtnClicked:function(){this.$socket.emit("sendMessage",{roomName:"public",UserId:this.currentUser.id,content:this.inputMessage}),this.inputMessage="",this.scrollToBottom()},scrollToBottom:function(){this.$refs.chatContainer.scrollTo({top:this.$refs.chatContainer.scrollHeight,behavior:"smooth"})},joinRoom:function(){var t="public";this.$socket.emit("join-room",t)},leaveRoom:function(){var t="public";this.$socket.emit("leave-room",t)}}},l=c,u=(s("2e10"),s("2877")),h=Object(u["a"])(l,a,n,!1,null,"4d8a5090",null);e["default"]=h.exports},e483:function(t,e,s){t.exports=s.p+"img/Vector_send-icon.dd906591.svg"}}]);
//# sourceMappingURL=chunk-325726d7.6d0012eb.js.map